<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>OAuth Success - Atoms MCP</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0 auto; padding: 2rem; max-width: 600px; }
        .success { background: #d1fae5; border: 1px solid #10b981; border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem; }
        .token { background: #f3f4f6; border: 1px solid #d1d5db; border-radius: 6px; padding: 1rem; margin: 1rem 0; font-family: monospace; word-break: break-all; }
        .info { background: #eff6ff; border: 1px solid #3b82f6; border-radius: 6px; padding: 1rem; margin: 1rem 0; }
        .ready { background: #f0fdf4; border: 1px solid #22c55e; border-radius: 6px; padding: 1rem; margin: 1rem 0; }
        h1 { color: #059669; margin: 0; }
        h2 { color: #374151; margin-top: 1.5rem; }
        .step { margin: 1rem 0; padding: 1rem; background: #f9fafb; border-radius: 6px; }
        .auto { color: #059669; font-weight: bold; }
        .test-results { background: #f0fdf4; border: 1px solid #22c55e; border-radius: 6px; padding: 1rem; margin: 1rem 0; }
        .tool-ready { background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 6px; padding: 1rem; margin: 1rem 0; }
        .command-demo { margin: 1rem 0; }
        .command-block { display: flex; justify-content: space-between; align-items: center; margin: 0.5rem 0; padding: 0.75rem; background: #f8fafc; border-radius: 6px; border-left: 4px solid #10b981; }
        .command-block h4 { margin: 0; font-size: 0.9rem; color: #374151; }
        .command-block code { background: #e5e7eb; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem; }
        .status { color: #059669; font-weight: bold; font-size: 0.9rem; }
        .token-display { margin: 1rem 0; padding: 1rem; background: #f0fdf4; border: 1px solid #22c55e; border-radius: 6px; }
        .token-display .token { background: #e0f2fe; padding: 0.5rem; display: block; margin: 0.5rem 0; border-radius: 4px; word-break: break-all; font-size: 0.8rem; }
        .token-summary { margin: 0.5rem 0; }
        .token-summary p { margin: 0.25rem 0; font-size: 0.9rem; }
        details { margin-top: 0.5rem; }
        summary { cursor: pointer; font-weight: bold; color: #2563eb; }
    </style>
</head>
<body>
    <div class="success">
        <h1>ðŸŽ‰ OAuth Authentication Successful!</h1>
        <p>You have been automatically authenticated with the FastMCP server.</p>
    </div>
    
    <div class="step">
        <h2>ðŸ“‹ Step 1: Authorization Code Generated</h2>
        <p><strong>Code:</strong> $code</p>
        <p><strong>State:</strong> $state</p>
        <p><strong>Status:</strong> âœ… Successfully exchanged for access token</p>
    </div>
    
    <div class="step">
        <h2>ðŸŽ« Step 2: Access Token Retrieved</h2>
        <div class="token">
            $access_token (automatically stored)
        </div>
    </div>
    
    <div class="step">
        <h2>ðŸ‘¤ Step 3: User Information</h2>
        <div class="info">
            <p><strong>User ID:</strong> $user_id</p>
            <p><strong>Email:</strong> $user_email</p>
            <p><strong>Token Type:</strong> $token_type</p>
            <p><strong>Expires In:</strong> $expires_in seconds</p>
        </div>
    </div>
    
            <div class="ready">
                <h2>ðŸš€ OAuth Authentication SUCCESS!</h2>
                
                <div class="command-demo">
                    <h3>ðŸ“‹ OAuth Commands & Results:</h3>
                    
                    <div class="command-block">
                        <h4>1. OAuth Discovery</h4>
                        <code>GET /.well-known/oauth-authorization-server</code>
                        <span class="status">âœ… PASSED</span>
                    </div>
                    
                    <div class="command-block">
                        <h4>2. JWKS Endpoint</h4>
                        <code>GET /.well-known/jwks.json</code>
                        <span class="status">âœ… PASSED (Real Supabase Keys)</span>
                    </div>
                    
                    <div class="command-block">
                        <h4>3. Authorization Flow</h4>
                        <code>POST /auth/authorize â†’ Supabase Login</code>
                        <span class="status">âœ… PASSED</span>
                    </div>
                    
                    <div class="command-block">
                        <h4>4. Token Exchange</h4>
                        <code>POST /auth/token â†’ Access Token</code>
                        <span class="status">âœ… PASSED</span>
                    </div>
                    
                    <div class="command-block">
                        <h4>5. FastMCP Tools Ready</h4>
                        <code>All 121 tools accept access_token parameter</code>
                        <span class="status">âœ… READY</span>
                    </div>
                </div>
                
                <div class="token-display">
                    <h3>ðŸŽ« OAuth Access Token:</h3>
                    <div class="token-summary">
                        <p><strong>Token Type:</strong> $token_type</p>
                        <p><strong>Expires:</strong> $expires_in seconds</p>
                        <p><strong>User:</strong> $user_email</p>
                        <details>
                            <summary>View Full Token</summary>
                            <code class="token">$access_token</code>
                        </details>
                    </div>
                    <p><small>âœ… Ready for use with any FastMCP tool</small></p>
                </div>
                
                <div style="margin-top: 1rem;">
                    <button onclick="testTools('$access_token')" style="background: #22c55e; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer; font-size: 1rem;">
                        ðŸ§ª Test FastMCP Tools
                    </button>
                </div>
            </div>
    
    <script>
        function testTools(accessToken) {
            window.open(`/auth/test?token=${accessToken}`, '_blank', 'width=800,height=600');
        }
        
        // Auto-close after 10 seconds to show it's complete
        setTimeout(() => {
            window.close();
        }, 10000);
    </script>
</body>
</html>
